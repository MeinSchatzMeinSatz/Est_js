# 실행 컨텍스트란?

실행 컨텍스트는 "현재 자바스크립트 코드가 어디에서 어떻게 실행되고 있는지에 관한 모든 환경 정보이다."

즉,

-   변수, 함수, 객체, this와 같은 정보들이 어디서 어떻게 연결되어 있는지.
-   어떤 값을 써야 하는지(스코프)
-   어떤 함수를 써야하는지

모두 실행 컨텍스트가 관리한다.

## 실행 컨텍스트의 동작 방식

### 콜 스택과 실행 컨텍스트

자바스크립트 엔진은 코드를 실행할 때마다 '실행 컨텍스트'를 콜 스택이라는 자료구조에 쌓는다.

[실행흐름]

1. 최초엔 전역(파일 전체)에 대한 실행 컨텍스트가 만들어져 스택에 들어갑니다.
2. 함수를 호출할 때마다 새로운 실행 컨텍스트가 생성되어 스택 위에 추가됩니다.
3. 함수 실행이 끝나면 스택에서 해당 컨텍스트가 제거(POP)됩니다.
4. 스택이 비면 프로그램 종료.

[실행 컨텍스트가 관리하는 것]

1. 변수 환경(레코드) : 변수, 함수 선언 정보를 저장. 어디서든 식별자 찾을 때 참고.
2. 스코프 체인 연결 : 외부 환경 참조. 상위 함수 / 전역의 변수도 접근 가능하게 한다.
3. 현재 컨텍스트가 가리키는 this가 누구인지 저장.

즉,
내가 쓴 변수는 어디에 있는지,
this는 무엇을 가리키는지,
함수/변수 접근 규칙
이 모든 것을 실행 컨텍스트가 관리한다.

### 쉽게 풀어보자

-   연극 무대 준비와 실제 공연

1. 생성 단계(무대 준비)
   무엇을 하는가? - 무대(함수, 전역, 코드 블록)가 만들어질 떄, 사용할 모든 배우(변수, 함수)를 미리 이름만 올려둔다. - 개봉 전 리허설 처럼 "여기 변수 XX, 함수 YY가 나와야 한다."라고 미리 메모장에 적어두는 과정이다.

구체적으로 무슨일이? - 변수 선언(호이스팅)
변수 / 함수의 이름이 이 단계에서부터 먼저 올라간다. - 초기화
_ var, function 등 선언만 하고 값(undefined)으로 초기화한다.
_ let, const 선언만 하고 값은 아직 없다(TDZ) \* 함수 선언문: 함수 전체가 메모리에 저장된다. - this 바인딩
이번 무대에서 this가 누구를 가리키는가 결정 - 스코프 / 외부환경 연결
바깥쪽 무대와 연결(상위 스코프 체인 기억) - 환경 레코드 만들기

2. 실행 단계(본 공연)
   무엇을 하나? - 막이 오르면 실제로 코드 한 줄 한 줄이 실행된다. - 이제 배우들이 자신의 대사(코드, 연산, 함수실행 등)대로 행동을 시작한다.

구체적으로 무슨 일이? - 변수 할당 / 값 변경
_ 선언된 변수에 값이 할당된다. - 함수 호출 / 실행
_ 함수가 불리면 새로운 무대(실행 컨텍스트)가 또 만들어져 스택 위에 올라온다.
_ 이 과정이 반복 - 연산 로직 처리
_ if / for 같은 분기, 연산 등 실행 - this 참조 및 스코프 탐색 \* 코드에서 사용하는 변수, this 등은 준비도니 노트와 외부 환경을 참고하며 값을 찾아간다.

### 간단히 정리해보자.

1. 함수나 전역코드가 실행되기 바로 직전
   -> 관련 정보 모두 미리떠올린다.(배우 캐스팅 및 무대 준비 => 각본만 있는 것과 비슷)
2. 진짜 실행 시작
   -> 실제 값 할당, 연산, 함수 실행 등 모든 동작 진행
3. 다른 함수 호출 시
   -> 무대가 겹겹이 쌓임(콜스택 위에 계속 새로운 실행 컨텍스트 생성)
4. 함수 실행 종료 시
   -> 해당 무대에서 사라진다.

=> 실행 컨텍스트의 생성은 "모든 변수, 함수와 환경을 먼저 준비해두는 과정". 실행은 "실제 값을 채우고 함수가 들어가는 본 공연", 자바스크립트 코드가 안전하고 질서 있게 동작하게 해주는 기반.
