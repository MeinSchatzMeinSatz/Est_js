# 실행 컨텍스트

[학습목표]
자바스크립트 코드가 실행되는 환경인 실행 컨텍스트에 대해 알아볼 것.
함수를 호출할 때 실행 컨텍스트에서 어떻게 동작 하는지 단계별로 살펴보기.
앞서 배웠던 함수 스코프가 어떤 정보를 저장하는지
호이스팅, 클로저와 같은 컨텍스트 내에서 동작하는 원리

## 실행 컨텍스트란 무엇인가?

자바스크립트 코드를 실행할 때 필요한 정보들을 저장하고 제공하는 환경
즉, 스코프의 정보를 담은 환경을 말한다.

현재 실행되고 있는 컨텍스트에서 이 컨텍스트와 관련이 없는 코드가 실행된다면 새로운 컨텍스트가 생성되어 제어권을 가져간다.
그리고 이렇게 실행된 실행 컨텍스트들은 실행 컨텍스트 스택 안에 쌓이게 된다.
각각의 컨텍스트는 실행이 종료된 이후 소멸한다.
소멸된 후 이전의 실행 컨텍스트에 제어권을 넘겨준다.
전역 실행 컨텍스트까지 실행이 완료되면 모든 실행이 완료된 것이다.

예제로 살펴보자

```javascript
console.log("global context");

function foo() {
    console.log("foo context");
}

function bar() {
    foo();
    console.log("bar context");
}
bar();
```

1. 가장 먼저 전역 코드가 실행되어 전역 실행 컨텍스트가 제어권을 가져간다. 그 결과 "global context"가 출력된다.
2. 전역 실행 컨텍스트에 bar() 함수가 호출되어 새로운 컨텍스트가 생성되어 스택에 쌓인다. 그리고 이 컨텍스트가 제어권을 가져간다. 이 과정이 foo() 힘스 호출 시에도 반복된다.
3. foo() 함수 안의 코드가 모두 실행되면 foo 실행 컨텍스트가 완료되어 소멸되며, 이후 bar 실행 컨텍스트도 완료되어 소멸된다. 최종적으로 전역 실행 컨텍스트까지 실행이 완료되어 모든 실행이 완료된다.

=> 실행 컨텍스트는 앞서 우리가 보았던 this 바인딩, 스코프, 호이스팅, 클로저 등 모든 동작의 원리를 알 수 있는 추상적인 개념이다.

## 실행 컨텍스트 구성 요소

실행 컨텍스트는 Lexical Environment(LE)와 Variable Environment(VE) 두 가지 컴포넌트(+컴포넌트란?)로 구성된다.
이 컴포넌트들은 Environment Records(ER)라 불리는 형태로 구성되어 있다.

간단히 말하면, ER은 LE와 VE로 구성되어 있다.

실행 컨텍스트의 LE와 VE는 foo 함수 호출에 대한 다양한 정보를 담고 있다. 선언한 식별자 this 바인딩 그리고 상위 스코프인 실행 컨텍스트의 Global ER을 참조하는 OuterEnv라는 필드가 있다.

### Environment Records와 스코프 체인

ER은 렉시컬 스코프를 기반으로 특정 변수와 함수에 대한 식별자의 연결 정보를 저장한다.

쉽게 말하면, 코드가 실행되었을떄 변수나 함수에 대한 식별자를 선언하고, 코드가 한 줄 한 줄 실행될 때마다 선언된 식별자에 값을 할당할 수 있도롣 바인딩하는 것이다.(호이스팅이네...?!)

함수 선언, 블록문 또는 try, catch절과 같은 구문들이 평가될 떄 식별자 바인딩을 위해 새로운 ER이 생성된다.

모든 ER에는 OuterEnv 필드가 존재한다.
이 필드는 상위 렉시컬 스코프에 대한 ER을 참조한다. - 최상위 실행 컨텍스트인 전역 컨텍스트에서는 참조할 상위 스코프가 존재하지 않는다. 그래서 OuterEnv 필드는 null이 된다.

스코프 체인의 원리가 바로 이것이다...!

### 다양한 Environment Records

ER은 추상 클래스이다.
이를 구현하는 세 가지 하위 ER이 있다.

-   declarative Environment Record
-   object Environment Record
-   global Environment Record

<declarative Environment Records>
변수, 상수, 클래스, 모듈 또는 함수 선언 등 렉시컬 스코프 내에 선언된 식별자들을 바인딩.

-   module Environment Record: 모듈의 외부 스코프를 나타내는 정보를 추가적으로 바인딩 한다.
-   function Environment Record: 함수 내의 최상위 위치에 선언한 식별자를 바인딩한다.

<object Envrionment Record>
- binding object라는 객체의 프로퍼티들을 식별자로 바인딩한다.

<global Environment Record>
- 최상위 전역 스코프에서 선언된 식별자와 전역 객체에 대한 바인딩을 한다.
