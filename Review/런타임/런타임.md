# 자바스크립트의 런타임이란?

## 정의

-   자바스크립트 런타임은 자바스크립트 코드가 실제로 "실행되는 환경"을 의미한다.
-   프로그램이 동작하는 시점의 환경(메모리 관리, 코드 실행, 이벤트 처리 등 전체 인프라)을 통틀어 부르는 말이다.
    (ex): 웹 브라우저(크롬, 사파리 등)와 Node.js(서버 환경)가 있다.

## 런타임 환경의 구성 요소

-   자바스크립트 엔진:
    코드를 해석하고 실행하는 핵심 레이어
-   Web API / Node API:
    DOM 조작, 타이머, AJAX, 네트워킹, 파일 시스템 접근 등 각 환경별로 제공하는 기능
    비동기 기능 제공
-   콜스택(Call Stack)
    함수 실행 순서, 호출 관리(한번에 하나씩, 순서대로)
-   힙(Heap)
    객체, 변수 등 데이터 저장(메모리 공간)
-   콜백 큐
    실행 대기 중인 비동기 함수(타이머, 이벤트 등)
-   이벤트 루프
    콜스택이 비었는지 감시, 비었을 때 큐에서 실행할 함수 콜스택에 이동.

### 런타임과 엔진의 차이

-   자바스크립트 엔진: 단순히 코드를 해석(파싱)하고, 실행(컴파일/인터프리터)합니다.
-   런타임: JS엔진 + 각 환경이 제공하는 API 및 시스템 전체 구조를 모두 포괄하는 개념

### 왜 중요한가?

-   환경마다 제공하는 기능(API)이 매우 다르다.
-   같은 자바스크립트 코드라도 브라우저에서만 동작하는 코드와 Node.js 에서만 동작하는 코드가 나눠진다.
-   비동기 프로그래밍(이벤트 루프, 태스크 큐 등)과 밀접한 관계가 있어 JS의 동작 원리와 안정적 코드 작성에 필수적이다.

## 그림 없이 상상하는 전체 흐름

1. 코드가 적재되고 시작
    - 자바스크립트 엔진이 코드를 파싱(해석)한다.
    - 변수, 함수 선언 등은 미리 메모리에 올려둘 준비(호이스팅)
2. 실행: 콜스택 중심으로
    - 함수가 호출되면 콜스택에 쌓인다.
    - 가장 위의 함수가 끝나면 스택에서 제거(후입선출 구조)
    - 동기 함수(즉시 실행)는 이 스택에서 순서대로 처리
3. 비동기 작업: Web API 와 Queue의 역할
    - 타이머, 이벤트, AJAX 요청 같은 작업은 Web API가 따로 처리
    - setTimeout은 Web API가 관리
    - 비동기 작업이 끝나면 Callback Queue에 콜백 함수가 저장된다.
    - 콜스택이 모두 처리되고 비어있으면, 이벤트 루프가 큐의 첫 콜백을 콜스택에 올린다.
4. 메모리 관리: Heap
    - 함수에서 사용하는 객체, 배열 등은 Heap에 저장한다.
    - 엔진이 주기적으로 안 쓰는 데이터를 정리한다.(가비지 컬렉션)
5. 반복: 이벤트 루프의 순환
    - 코드실행->비동기 대기->콜백 큐->다시 실행...
    - 이 과정이 계속 반복되어 자바스크립트가 "동시"로 여러 일을 하는 것처럼 보인다.

### 정리 포인트

-   자바스크립트는 단일 스레드(한 번에 한 코드만 실행한다), 콜스택 덕분에 순서를 보장한다.
-   비동기 처리는 Web API, 콜백 큐, 이벤트 루프 덕분에 "동시에 여러 일"을 하는 것처럼 동작한다.
-   주기적으로 스택이 비면 큐에서 대기 중인 함수를 콜스택에 올린다.
-   실행 중인 함수와 기다리는 함수가 철저하게 구분되어 동작한다.
